<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10-Q Financial Comparison Analyzer</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-yellow: #d29922;
            --accent-purple: #a371f7;
            --border-color: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .file-input-card {
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-input-card:hover {
            border-color: var(--accent-blue);
            background: var(--bg-tertiary);
        }

        .file-input-card.loaded {
            border-color: var(--accent-green);
            border-style: solid;
        }

        .file-input-card h3 {
            color: var(--accent-blue);
            margin-bottom: 1rem;
        }

        .file-input-card input[type="file"] {
            display: none;
        }

        .file-input-card label {
            display: block;
            padding: 1rem 2rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .file-input-card label:hover {
            background: var(--accent-blue);
            color: var(--bg-primary);
        }

        .file-name {
            margin-top: 1rem;
            color: var(--accent-green);
            font-size: 0.9rem;
            word-break: break-all;
        }

        .url-input {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-top: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
        }

        .url-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .analyze-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(88, 166, 255, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            display: none;
        }

        .results-section.visible {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--accent-blue);
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            color: var(--accent-blue);
            font-weight: 600;
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        .metric-name {
            color: var(--text-secondary);
        }

        .positive {
            color: var(--accent-green);
        }

        .negative {
            color: var(--accent-red);
        }

        .neutral {
            color: var(--text-primary);
        }

        .na {
            color: var(--text-secondary);
            font-style: italic;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .summary-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent-blue);
        }

        .summary-card.warning {
            border-left-color: var(--accent-red);
        }

        .summary-card h4 {
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .summary-card.warning h4 {
            color: var(--accent-red);
        }

        .red-flag {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
            color: var(--accent-red);
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .export-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: var(--accent-blue);
            color: var(--bg-primary);
            border-color: var(--accent-blue);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-blue);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .instructions {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent-yellow);
        }

        .instructions h3 {
            color: var(--accent-yellow);
            margin-bottom: 1rem;
        }

        .instructions ol {
            margin-left: 1.5rem;
            color: var(--text-secondary);
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .instructions a {
            color: var(--accent-blue);
        }

        @media (max-width: 900px) {
            .input-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä 10-Q Financial Analyzer</h1>
            <p class="subtitle">Compare SEC 10-Q filings side-by-side</p>
        </header>

        <div class="instructions">
            <h3>üìã How to Use</h3>
            <ol>
                <li>Go to <a href="https://www.sec.gov/edgar/searchedgar/companysearch.html" target="_blank">SEC EDGAR</a></li>
                <li>Search for a company and find their latest 10-Q filing</li>
                <li>Click "Documents" and download the HTML file (e.g., <code>goog-20250930.htm</code>)</li>
                <li>Upload 3 HTML files below to compare</li>
            </ol>
        </div>

        <div class="input-section">
            <div class="file-input-card" id="card1">
                <h3>Company 1</h3>
                <input type="file" id="file1" accept=".html,.htm" onchange="handleFileSelect(1)">
                <label for="file1">üìÑ Choose HTML File</label>
                <div class="file-name" id="filename1"></div>
            </div>
            <div class="file-input-card" id="card2">
                <h3>Company 2</h3>
                <input type="file" id="file2" accept=".html,.htm" onchange="handleFileSelect(2)">
                <label for="file2">üìÑ Choose HTML File</label>
                <div class="file-name" id="filename2"></div>
            </div>
            <div class="file-input-card" id="card3">
                <h3>Company 3</h3>
                <input type="file" id="file3" accept=".html,.htm" onchange="handleFileSelect(3)">
                <label for="file3">üìÑ Choose HTML File</label>
                <div class="file-name" id="filename3"></div>
            </div>
        </div>

        <button class="analyze-btn" onclick="analyzeFiles()" id="analyzeBtn" disabled>
            üîç Analyze & Compare
        </button>

        <div class="loading" id="loading" style="display: none;">
            Analyzing financial data...
        </div>

        <div class="results-section" id="results">
            <div class="export-buttons">
                <button class="export-btn" onclick="exportMarkdown()">üìù Export Markdown</button>
                <button class="export-btn" onclick="exportJSON()">üìä Export JSON</button>
                <button class="export-btn" onclick="exportCSV()">üìà Export CSV</button>
            </div>

            <h2 class="section-title">üìã Company Overview</h2>
            <table id="overviewTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Company</th>
                        <th>Filing Period</th>
                        <th>Source</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h2 class="section-title">üí∞ Income Statement</h2>
            <table id="incomeTable">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th id="income-h1">Company 1</th>
                        <th id="income-h2">Company 2</th>
                        <th id="income-h3">Company 3</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h2 class="section-title">üè¶ Balance Sheet</h2>
            <table id="balanceTable">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th id="balance-h1">Company 1</th>
                        <th id="balance-h2">Company 2</th>
                        <th id="balance-h3">Company 3</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h2 class="section-title">üíµ Cash Flow</h2>
            <table id="cashflowTable">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th id="cashflow-h1">Company 1</th>
                        <th id="cashflow-h2">Company 2</th>
                        <th id="cashflow-h3">Company 3</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h2 class="section-title">üìä Key Ratios</h2>
            <table id="ratiosTable">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th id="ratios-h1">Company 1</th>
                        <th id="ratios-h2">Company 2</th>
                        <th id="ratios-h3">Company 3</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h2 class="section-title">üèÜ Executive Summary</h2>
            <div class="summary-cards" id="summaryCards"></div>

            <h2 class="section-title">‚ö†Ô∏è Red Flags</h2>
            <div class="summary-cards" id="redFlags"></div>
        </div>
    </div>

    <script>
        let fileContents = [null, null, null];
        let analysisResults = [];

        function handleFileSelect(num) {
            const file = document.getElementById(`file${num}`).files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileContents[num - 1] = e.target.result;
                    document.getElementById(`filename${num}`).textContent = `‚úÖ ${file.name}`;
                    document.getElementById(`card${num}`).classList.add('loaded');
                    checkAllFilesLoaded();
                };
                reader.readAsText(file);
            }
        }

        function checkAllFilesLoaded() {
            const allLoaded = fileContents.every(f => f !== null);
            document.getElementById('analyzeBtn').disabled = !allLoaded;
        }

        function extractTextFromHTML(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Remove script and style elements
            doc.querySelectorAll('script, style').forEach(el => el.remove());
            
            return doc.body.textContent || doc.body.innerText || '';
        }

        function extractTablesFromHTML(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const tables = [];
            
            doc.querySelectorAll('table').forEach(table => {
                const rows = [];
                table.querySelectorAll('tr').forEach(tr => {
                    const cells = [];
                    tr.querySelectorAll('td, th').forEach(cell => {
                        cells.push(cell.textContent.trim().replace(/\s+/g, ' '));
                    });
                    if (cells.length > 0) {
                        rows.push(cells);
                    }
                });
                if (rows.length > 0) {
                    tables.push(rows);
                }
            });
            
            return tables;
        }

        function parseNumber(str) {
            if (!str || str === 'N/A' || str === '‚Äî' || str === '-') return null;
            
            // Remove currency symbols and whitespace
            let clean = str.replace(/[$,\s]/g, '');
            
            // Check for parentheses (negative)
            const isNegative = clean.includes('(') && clean.includes(')');
            clean = clean.replace(/[()]/g, '');
            
            // Parse the number
            let num = parseFloat(clean);
            if (isNaN(num)) return null;
            
            if (isNegative) num = -num;
            
            return num;
        }

        function findValueInTables(tables, keywords, columnOffset = 1) {
            const keywordLower = keywords.map(k => k.toLowerCase());
            
            for (const table of tables) {
                for (const row of table) {
                    const rowText = row.join(' ').toLowerCase();
                    
                    for (const keyword of keywordLower) {
                        if (rowText.includes(keyword)) {
                            // Look for numbers in subsequent cells
                            for (let i = 1; i < row.length; i++) {
                                const num = parseNumber(row[i]);
                                if (num !== null) {
                                    return num;
                                }
                            }
                        }
                    }
                }
            }
            return null;
        }

        function extractCompanyName(text) {
            const patterns = [
                /FORM\s+10-Q.*?([A-Z][A-Za-z\s,\.]+(?:Inc\.|Corporation|Corp\.|LLC|Ltd\.|Company|Co\.))/i,
                /([A-Z][A-Za-z\s]+(?:Inc\.|Corporation|Corp\.|LLC|Ltd\.|Company|Co\.))/,
            ];
            
            for (const pattern of patterns) {
                const match = text.substring(0, 5000).match(pattern);
                if (match) {
                    const name = match[1].trim().replace(/\s+/g, ' ');
                    if (name.length > 3 && name.length < 80) {
                        return name;
                    }
                }
            }
            return 'Unknown Company';
        }

        function extractFilingPeriod(text) {
            const patterns = [
                /(?:FOR\s+THE\s+)?(?:QUARTERLY\s+PERIOD|QUARTER)\s+(?:ENDED|ENDING)\s+(\w+\s+\d{1,2},?\s+\d{4})/i,
                /(?:THREE|NINE)\s+MONTHS\s+ENDED\s+(\w+\s+\d{1,2},?\s+\d{4})/i,
            ];
            
            for (const pattern of patterns) {
                const match = text.substring(0, 5000).match(pattern);
                if (match) {
                    return match[1].trim();
                }
            }
            return 'N/A';
        }

        function analyzeHTML(html, filename) {
            const text = extractTextFromHTML(html);
            const tables = extractTablesFromHTML(html);
            
            const company = {
                name: extractCompanyName(text),
                period: extractFilingPeriod(text),
                source: filename,
                financials: {},
                qualitative: {}
            };
            
            // Income Statement
            company.financials.revenue = findValueInTables(tables, ['total revenues', 'net revenues', 'total net revenues', 'net sales', 'total sales']);
            company.financials.netIncome = findValueInTables(tables, ['net income', 'net income (loss)', 'net earnings']);
            company.financials.operatingIncome = findValueInTables(tables, ['income from operations', 'operating income', 'operating income (loss)']);
            company.financials.grossProfit = findValueInTables(tables, ['gross profit', 'gross margin']);
            company.financials.costOfRevenue = findValueInTables(tables, ['cost of revenues', 'cost of sales', 'cost of goods sold']);
            
            // Balance Sheet
            company.financials.totalAssets = findValueInTables(tables, ['total assets']);
            company.financials.cashEquivalents = findValueInTables(tables, ['cash and cash equivalents', 'cash, cash equivalents']);
            company.financials.marketableSecurities = findValueInTables(tables, ['marketable securities', 'short-term investments']);
            company.financials.currentAssets = findValueInTables(tables, ['total current assets']);
            company.financials.totalLiabilities = findValueInTables(tables, ['total liabilities']);
            company.financials.currentLiabilities = findValueInTables(tables, ['total current liabilities']);
            company.financials.longTermDebt = findValueInTables(tables, ['long-term debt', 'long-term notes payable']);
            company.financials.totalEquity = findValueInTables(tables, ["total stockholders' equity", "total shareholders' equity", "total equity"]);
            
            // Cash Flow
            company.financials.operatingCashFlow = findValueInTables(tables, ['net cash provided by operating', 'cash flows from operating', 'operating activities']);
            company.financials.investingCashFlow = findValueInTables(tables, ['net cash used in investing', 'cash flows from investing', 'investing activities']);
            company.financials.financingCashFlow = findValueInTables(tables, ['net cash used in financing', 'cash flows from financing', 'financing activities']);
            company.financials.capex = findValueInTables(tables, ['capital expenditures', 'purchases of property', 'property and equipment']);
            
            // Calculate derived metrics
            if (company.financials.operatingCashFlow && company.financials.capex) {
                company.financials.freeCashFlow = company.financials.operatingCashFlow - Math.abs(company.financials.capex);
            }
            
            if (company.financials.revenue && company.financials.netIncome) {
                company.financials.netMargin = (company.financials.netIncome / company.financials.revenue) * 100;
            }
            
            if (company.financials.currentAssets && company.financials.currentLiabilities) {
                company.financials.currentRatio = company.financials.currentAssets / company.financials.currentLiabilities;
            }
            
            if (company.financials.longTermDebt && company.financials.totalAssets) {
                company.financials.debtToAssets = (company.financials.longTermDebt / company.financials.totalAssets) * 100;
            }
            
            if (company.financials.cashEquivalents && company.financials.longTermDebt) {
                company.financials.netCash = company.financials.cashEquivalents - company.financials.longTermDebt;
            }
            
            return company;
        }

        function formatNumber(value, prefix = '$', suffix = '', decimals = 1) {
            if (value === null || value === undefined) return '<span class="na">N/A</span>';
            
            let formatted;
            const absValue = Math.abs(value);
            
            if (absValue >= 1000) {
                formatted = (value / 1000).toFixed(decimals) + 'B';
            } else if (absValue >= 1) {
                formatted = value.toFixed(decimals) + 'M';
            } else {
                formatted = value.toFixed(decimals);
            }
            
            const className = value < 0 ? 'negative' : 'positive';
            if (value < 0) {
                return `<span class="${className}">(${prefix}${Math.abs(value / 1000).toFixed(decimals)}B)</span>`;
            }
            return `<span class="${className}">${prefix}${formatted}${suffix}</span>`;
        }

        function formatPercent(value, decimals = 1) {
            if (value === null || value === undefined) return '<span class="na">N/A</span>';
            const className = value < 0 ? 'negative' : 'positive';
            return `<span class="${className}">${value.toFixed(decimals)}%</span>`;
        }

        function formatRatio(value, decimals = 2) {
            if (value === null || value === undefined) return '<span class="na">N/A</span>';
            const className = value < 1 ? 'negative' : 'positive';
            return `<span class="${className}">${value.toFixed(decimals)}</span>`;
        }

        async function analyzeFiles() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').classList.remove('visible');
            
            // Small delay to show loading
            await new Promise(resolve => setTimeout(resolve, 100));
            
            try {
                analysisResults = [];
                
                for (let i = 0; i < 3; i++) {
                    const filename = document.getElementById(`file${i + 1}`).files[0]?.name || `File ${i + 1}`;
                    const result = analyzeHTML(fileContents[i], filename);
                    analysisResults.push(result);
                }
                
                displayResults();
            } catch (error) {
                alert('Error analyzing files: ' + error.message);
                console.error(error);
            }
            
            document.getElementById('loading').style.display = 'none';
        }

        function displayResults() {
            const companies = analysisResults;
            
            // Update headers
            for (let i = 0; i < 3; i++) {
                const shortName = companies[i].name.substring(0, 20);
                document.getElementById(`income-h${i + 1}`).textContent = shortName;
                document.getElementById(`balance-h${i + 1}`).textContent = shortName;
                document.getElementById(`cashflow-h${i + 1}`).textContent = shortName;
                document.getElementById(`ratios-h${i + 1}`).textContent = shortName;
            }
            
            // Overview table
            const overviewBody = document.querySelector('#overviewTable tbody');
            overviewBody.innerHTML = companies.map((c, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${c.name}</td>
                    <td>${c.period}</td>
                    <td>${c.source}</td>
                </tr>
            `).join('');
            
            // Income Statement
            const incomeMetrics = [
                ['Revenue', 'revenue'],
                ['Net Income', 'netIncome'],
                ['Operating Income', 'operatingIncome'],
                ['Gross Profit', 'grossProfit'],
                ['Net Margin', 'netMargin', 'percent'],
            ];
            
            const incomeBody = document.querySelector('#incomeTable tbody');
            incomeBody.innerHTML = incomeMetrics.map(([label, key, type]) => `
                <tr>
                    <td class="metric-name">${label}</td>
                    ${companies.map(c => `<td>${type === 'percent' ? formatPercent(c.financials[key]) : formatNumber(c.financials[key])}</td>`).join('')}
                </tr>
            `).join('');
            
            // Balance Sheet
            const balanceMetrics = [
                ['Total Assets', 'totalAssets'],
                ['Cash & Equivalents', 'cashEquivalents'],
                ['Marketable Securities', 'marketableSecurities'],
                ['Current Assets', 'currentAssets'],
                ['Total Liabilities', 'totalLiabilities'],
                ['Current Liabilities', 'currentLiabilities'],
                ['Long-Term Debt', 'longTermDebt'],
                ['Total Equity', 'totalEquity'],
            ];
            
            const balanceBody = document.querySelector('#balanceTable tbody');
            balanceBody.innerHTML = balanceMetrics.map(([label, key]) => `
                <tr>
                    <td class="metric-name">${label}</td>
                    ${companies.map(c => `<td>${formatNumber(c.financials[key])}</td>`).join('')}
                </tr>
            `).join('');
            
            // Cash Flow
            const cashflowMetrics = [
                ['Operating Cash Flow', 'operatingCashFlow'],
                ['Investing Cash Flow', 'investingCashFlow'],
                ['Financing Cash Flow', 'financingCashFlow'],
                ['Capital Expenditures', 'capex'],
                ['Free Cash Flow', 'freeCashFlow'],
            ];
            
            const cashflowBody = document.querySelector('#cashflowTable tbody');
            cashflowBody.innerHTML = cashflowMetrics.map(([label, key]) => `
                <tr>
                    <td class="metric-name">${label}</td>
                    ${companies.map(c => `<td>${formatNumber(c.financials[key])}</td>`).join('')}
                </tr>
            `).join('');
            
            // Ratios
            const ratiosMetrics = [
                ['Current Ratio', 'currentRatio', 'ratio'],
                ['Debt-to-Assets', 'debtToAssets', 'percent'],
                ['Net Cash Position', 'netCash', 'number'],
            ];
            
            const ratiosBody = document.querySelector('#ratiosTable tbody');
            ratiosBody.innerHTML = ratiosMetrics.map(([label, key, type]) => `
                <tr>
                    <td class="metric-name">${label}</td>
                    ${companies.map(c => `<td>${
                        type === 'percent' ? formatPercent(c.financials[key]) :
                        type === 'ratio' ? formatRatio(c.financials[key]) :
                        formatNumber(c.financials[key])
                    }</td>`).join('')}
                </tr>
            `).join('');
            
            // Summary Cards
            const summaryCards = document.getElementById('summaryCards');
            const summaries = [];
            
            // Find best performers
            const validAssets = companies.filter(c => c.financials.totalAssets);
            if (validAssets.length > 0) {
                const best = validAssets.reduce((a, b) => (a.financials.totalAssets || 0) > (b.financials.totalAssets || 0) ? a : b);
                summaries.push({ title: 'üèÜ Strongest Balance Sheet', text: `${best.name} with $${(best.financials.totalAssets / 1000).toFixed(1)}B total assets` });
            }
            
            const validOCF = companies.filter(c => c.financials.operatingCashFlow);
            if (validOCF.length > 0) {
                const best = validOCF.reduce((a, b) => (a.financials.operatingCashFlow || 0) > (b.financials.operatingCashFlow || 0) ? a : b);
                summaries.push({ title: 'üí∞ Highest Operating Cash Flow', text: `${best.name} with $${(best.financials.operatingCashFlow / 1000).toFixed(1)}B` });
            }
            
            const validMargin = companies.filter(c => c.financials.netMargin);
            if (validMargin.length > 0) {
                const best = validMargin.reduce((a, b) => (a.financials.netMargin || -999) > (b.financials.netMargin || -999) ? a : b);
                summaries.push({ title: 'üìà Highest Net Margin', text: `${best.name} with ${best.financials.netMargin.toFixed(1)}%` });
            }
            
            summaryCards.innerHTML = summaries.map(s => `
                <div class="summary-card">
                    <h4>${s.title}</h4>
                    <p>${s.text}</p>
                </div>
            `).join('');
            
            // Red Flags
            const redFlags = document.getElementById('redFlags');
            const flags = [];
            
            for (const c of companies) {
                const companyFlags = [];
                
                if (c.financials.freeCashFlow && c.financials.freeCashFlow < 0) {
                    companyFlags.push(`Negative free cash flow ($${(c.financials.freeCashFlow / 1000).toFixed(1)}B)`);
                }
                
                if (c.financials.debtToAssets && c.financials.debtToAssets > 50) {
                    companyFlags.push(`High debt-to-assets (${c.financials.debtToAssets.toFixed(1)}%)`);
                }
                
                if (c.financials.currentRatio && c.financials.currentRatio < 1) {
                    companyFlags.push(`Low current ratio (${c.financials.currentRatio.toFixed(2)})`);
                }
                
                if (companyFlags.length > 0) {
                    flags.push({ company: c.name, flags: companyFlags });
                }
            }
            
            redFlags.innerHTML = flags.map(f => `
                <div class="summary-card warning">
                    <h4>‚ö†Ô∏è ${f.company}</h4>
                    ${f.flags.map(flag => `<div class="red-flag">‚Ä¢ ${flag}</div>`).join('')}
                </div>
            `).join('') || '<div class="summary-card"><h4>‚úÖ No Red Flags</h4><p>All companies appear financially healthy</p></div>';
            
            document.getElementById('results').classList.add('visible');
        }

        function exportMarkdown() {
            const companies = analysisResults;
            let md = `# 10-Q FINANCIAL COMPARISON REPORT\n\n`;
            md += `*Generated: ${new Date().toLocaleString()}*\n\n`;
            
            md += `## Company Overview\n\n`;
            md += `| # | Company | Filing Period |\n`;
            md += `|---|---------|---------------|\n`;
            companies.forEach((c, i) => {
                md += `| ${i + 1} | ${c.name} | ${c.period} |\n`;
            });
            
            md += `\n## Income Statement\n\n`;
            md += `| Metric | ${companies.map(c => c.name.substring(0, 15)).join(' | ')} |\n`;
            md += `|--------|${companies.map(() => '----------').join('|')}|\n`;
            
            const formatMd = (v) => v === null ? 'N/A' : (v >= 1000 ? `$${(v/1000).toFixed(1)}B` : `$${v.toFixed(1)}M`);
            
            md += `| Revenue | ${companies.map(c => formatMd(c.financials.revenue)).join(' | ')} |\n`;
            md += `| Net Income | ${companies.map(c => formatMd(c.financials.netIncome)).join(' | ')} |\n`;
            md += `| Operating Income | ${companies.map(c => formatMd(c.financials.operatingIncome)).join(' | ')} |\n`;
            
            const blob = new Blob([md], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '10q_comparison_report.md';
            a.click();
        }

        function exportJSON() {
            const data = {
                generated: new Date().toISOString(),
                companies: analysisResults
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '10q_comparison_data.json';
            a.click();
        }

        function exportCSV() {
            const companies = analysisResults;
            let csv = 'Metric,' + companies.map(c => `"${c.name}"`).join(',') + '\n';
            
            const metrics = [
                ['Revenue', 'revenue'],
                ['Net Income', 'netIncome'],
                ['Operating Income', 'operatingIncome'],
                ['Total Assets', 'totalAssets'],
                ['Cash & Equivalents', 'cashEquivalents'],
                ['Total Liabilities', 'totalLiabilities'],
                ['Long-Term Debt', 'longTermDebt'],
                ['Total Equity', 'totalEquity'],
                ['Operating Cash Flow', 'operatingCashFlow'],
                ['Free Cash Flow', 'freeCashFlow'],
                ['Net Margin (%)', 'netMargin'],
                ['Current Ratio', 'currentRatio'],
                ['Debt-to-Assets (%)', 'debtToAssets'],
            ];
            
            for (const [label, key] of metrics) {
                csv += `"${label}",${companies.map(c => c.financials[key] ?? '').join(',')}\n`;
            }
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '10q_comparison_data.csv';
            a.click();
        }
    </script>
</body>
</html>

